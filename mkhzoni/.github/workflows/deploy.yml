name: Deploy Flutter Web to GitHub Pages

# 1. متى يعمل هذا الـ Workflow
on:
  push:
      branches:
            - main # يعمل فقط عند الدفع إلى الفرع الرئيسي

            jobs:
              build_and_deploy:
                  runs-on: ubuntu-latest # 2. نوع النظام الذي سيعمل عليه

                      steps:
                            # 3. جلب الكود من المستودع
                                  - name: Checkout code
                                          uses: actions/checkout@v3

                                                # 4. تثبيت Flutter SDK
                                                      - name: Setup Flutter
                                                              uses: subosito/flutter-action@v2
                                                                      with:
                                                                                channel: 'stable' # استخدم النسخة المستقرة من فلاتر

                                                                                      # 5. تثبيت أدوات Firebase CLI
                                                                                            - name: Install Firebase CLI
                                                                                                    run: |
                                                                                                              sudo npm install -g firebase-tools
                                                                                                                            
                                                                                                                                  # 6. إنشاء ملف firebase_options.dart من الـ Secrets
                                                                                                                                        #    (هذه الخطوة مهمة جداً لحماية مفاتيحك)
                                                                                                                                              - name: Create Firebase Options file
                                                                                                                                                      env:
                                                                                                                                                                FIREBASE_OPTIONS_CONTENT: ${{ secrets.FIREBASE_OPTIONS }}
                                                                                                                                                                        run: echo "$FIREBASE_OPTIONS_CONTENT" > lib/firebase_options.dart

                                                                                                                                                                              # 7. تثبيت حزم المشروع
                                                                                                                                                                                    - name: Install dependencies
                                                                                                                                                                                            run: flutter pub get

                                                                                                                                                                                                  # 8. بناء نسخة الويب من التطبيق
                                                                                                                                                                                                        - name: Build Flutter Web
                                                                                                                                                                                                                run: flutter build web --release --base-href /mkhzoni/
                                                                                                                                                                                                                        # ملاحظة: غير 'mkhzoni' إلى اسم المستودع الخاص بك إذا كان مختلفاً

                                                                                                                                                                                                                              # 9. نشر المجلد المبني إلى GitHub Pages
                                                                                                                                                                                                                                    - name: Deploy to GitHub Pages
                                                                                                                                                                                                                                            uses: peaceiris/actions-gh-pages@v3
                                                                                                                                                                                                                                                    with:
                                                                                                                                                                                                                                                              github_token: ${{ secrets.GITHUB_TOKEN }}
                                                                                                                                                                                                                                                                        publish_dir: ./build/web
                                                                                                                                                                                                                                                                        